--- prog/detect/sensors-detect.orig	2009-02-26 18:15:04.000000000 +0200
+++ prog/detect/sensors-detect	2009-03-17 00:11:15.000000000 +0200
@@ -5255,110 +5255,23 @@
 
 sub write_config
 {
-	my ($configfile, $bus_modules, $hwmon_modules) = @_;
-
-	if (defined $configfile) {
-		my $have_modprobe_d = -d '/etc/modprobe.d';
-		printf "Do you want to \%s /etc/modprobe.d/lm_sensors? (\%s): ",
-		       (-e '/etc/modprobe.d/lm_sensors' ? 'overwrite' : 'generate'),
-		       ($have_modprobe_d ? 'YES/no' : 'yes/NO');
-		$_ = <STDIN>;
-		if (($have_modprobe_d and not m/^\s*n/i) or m/^\s*y/i) {
-			unless ($have_modprobe_d) {
-				mkdir('/etc/modprobe.d', 0777)
-					or die "Sorry, can't create /etc/modprobe.d ($!)";
-			}
-			open(local *MODPROBE_D, ">/etc/modprobe.d/lm_sensors")
-				or die "Sorry, can't create /etc/modprobe.d/lm_sensors ($!)";
-			print MODPROBE_D "# Generated by sensors-detect on " . scalar localtime() . "\n";
-			print MODPROBE_D $configfile;
-			close(MODPROBE_D);
-		} else {
-			print "To make the sensors modules behave correctly, add these lines to\n".
-			      "/etc/modprobe.conf:\n\n";
-			print "#----cut here----\n".
-			      $configfile.
-			      "#----cut here----\n\n";
-		}
-	}
-
-	my $have_sysconfig = -d '/etc/sysconfig';
-	printf "Do you want to \%s /etc/sysconfig/lm_sensors? (\%s): ",
-	       (-e '/etc/sysconfig/lm_sensors' ? 'overwrite' : 'generate'),
-	       ($have_sysconfig ? 'YES/no' : 'yes/NO');
-	$_ = <STDIN>;
-	if (($have_sysconfig and not m/^\s*n/i) or m/^\s*y/i) {
-		unless ($have_sysconfig) {
-			mkdir('/etc/sysconfig', 0777)
-				or die "Sorry, can't create /etc/sysconfig ($!)";
-		}
-		open(local *SYSCONFIG, ">/etc/sysconfig/lm_sensors")
-			or die "Sorry, can't create /etc/sysconfig/lm_sensors ($!)";
-		print SYSCONFIG "# Generated by sensors-detect on " . scalar localtime() . "\n";
-		print SYSCONFIG <<'EOT';
-# This file is sourced by /etc/init.d/lm_sensors and defines the modules to
-# be loaded/unloaded.
-#
-# The format of this file is a shell script that simply defines variables:
-# HWMON_MODULES for hardware monitoring driver modules, and optionally
-# BUS_MODULES for any required bus driver module (for example for I2C or SPI).
-
-EOT
-		print SYSCONFIG "BUS_MODULES=\"", join(" ", @{$bus_modules}), "\"\n"
-			if @{$bus_modules};
-		print SYSCONFIG "HWMON_MODULES=\"", join(" ", @{$hwmon_modules}), "\"\n";
-
-		print SYSCONFIG <<'EOT';
-
-# For compatibility reasons, modules are also listed individually as variables
-#    MODULE_0, MODULE_1, MODULE_2, etc.
-# You should use BUS_MODULES and HWMON_MODULES instead if possible.
-
-EOT
-		my $i = 0;
-		foreach (@{$bus_modules}, @{$hwmon_modules}) {
-			print SYSCONFIG "MODULE_$i=$_\n";
-			$i++;
-		}
-		close(SYSCONFIG);
-
-		print "Copy prog/init/lm_sensors.init to /etc/init.d/lm_sensors\n".
-		      "for initialization at boot time.\n"
-			unless -f "/etc/init.d/lm_sensors";
-
-		if (-x "/sbin/insserv" && -f "/etc/init.d/lm_sensors") {
-			system("/sbin/insserv", "/etc/init.d/lm_sensors");
-		} elsif (-x "/sbin/chkconfig" && -f "/etc/init.d/lm_sensors") {
-			system("/sbin/chkconfig", "lm_sensors", "on");
-			if (-x "/sbin/service") {
-				system("/sbin/service", "lm_sensors", "start");
-			}
-		} else {
-			print "You should now start the lm_sensors service to load the required\n".
-			      "kernel modules.\n\n";
-		}
-	} else {
-		print "To load everything that is needed, add this to one of the system\n".
-		      "initialization scripts (e.g. /etc/rc.d/rc.local):\n\n";
-		print "#----cut here----\n";
-		if (@{$bus_modules}) {
-			print "# Adapter drivers\n";
-			print "modprobe $_\n" foreach (@{$bus_modules});
-		}
-		print "# Chip drivers\n";
-		print "modprobe $_\n" foreach (@{$hwmon_modules});
-		print((-e '/usr/bin/sensors' ?
-		       "/usr/bin/sensors -s\n" :
-		       "/usr/local/bin/sensors -s\n").
-		      "#----cut here----\n\n");
-
-		print "If you have some drivers built into your kernel, the list above will\n".
-		      "contain too many modules. Skip the appropriate ones! You really\n".
-		      "should try these commands right now to make sure everything is\n".
-		      "working properly. Monitoring programs won't work until the needed\n".
-		      "modules are loaded.\n\n";
-	}
-
+    my ($configfile, $bus_modules, $hwmon_modules) = @_;
+    
+    print "Loading Modules\n";
+    my $modules = ($bus_modules, $hwmon_modules);
+    foreach (@$modules)
+    {
+        print "  * " . $_;
+        system "modprobe " . $_;
+    }
+    print "\nDo you want to load these modules on startup (YES/no): ";
+    if (not <STDIN> =~ /\s*[Nn]/)
+    {
+        foreach (@$modules)
+        {
+            system "hav call module_init_tools Boot.Modules addAutoload $_ 2.6 >/dev/null";
+        }
+    }
 }
 
 sub main
@@ -5377,11 +5290,6 @@
 		exit -1;
 	}
 
-	if (-x "/sbin/service" && -f "/etc/init.d/lm_sensors" &&
-	    -f "/var/lock/subsys/lm_sensors") {
-		system("/sbin/service", "lm_sensors", "stop");
-	}
-
 	initialize_kernel_version();
 	initialize_conf();
 	initialize_pci();
