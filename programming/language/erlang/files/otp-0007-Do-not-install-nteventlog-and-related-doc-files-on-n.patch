From 02e9c2f2583b3d1b706af4fa05d6efc33cc293b8 Mon Sep 17 00:00:00 2001
From: Peter Lemenkov <lemenkov@gmail.com>
Date: Sat, 19 Jun 2010 09:59:39 +0400
Subject: [PATCH] Do not install nteventlog and related doc-files on non-win32 systems

Signed-off-by: Peter Lemenkov <lemenkov@gmail.com>
---
 lib/os_mon/doc/src/Makefile |    7 ++++++-
 lib/os_mon/src/Makefile     |   11 ++++++++++-
 2 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/lib/os_mon/doc/src/Makefile b/lib/os_mon/doc/src/Makefile
index 8d75df9..95f0101 100644
--- a/lib/os_mon/doc/src/Makefile
+++ b/lib/os_mon/doc/src/Makefile
@@ -35,12 +35,17 @@ RELSYSDIR = $(RELEASE_PATH)/lib/$(APPLICATION)-$(VSN)
 # Target Specs
 # ----------------------------------------------------
 XML_APPLICATION_FILES = ref_man.xml
+ifeq ($(findstring win32,$(TARGET)),win32)
+NTEVENTLOG_DOCFILE=nteventlog.xml
+else
+NTEVENTLOG_DOCFILE=
+endif
 XML_REF3_FILES = cpu_sup.xml \
 	disksup.xml \
 	memsup.xml \
 	os_mon_mib.xml \
 	os_sup.xml \
-	nteventlog.xml
+	$(NTEVENTLOG_DOCFILE)
 
 XML_REF6_FILES = os_mon_app.xml 
 
diff --git a/lib/os_mon/src/Makefile b/lib/os_mon/src/Makefile
index 9a75446..a492a63 100644
--- a/lib/os_mon/src/Makefile
+++ b/lib/os_mon/src/Makefile
@@ -33,8 +33,13 @@ RELSYSDIR = $(RELEASE_PATH)/lib/os_mon-$(VSN)
 # ----------------------------------------------------
 # Target Specs
 # ----------------------------------------------------
+ifeq ($(findstring win32,$(TARGET)),win32)
+NTEVENTLOG=nteventlog
+else
+NTEVENTLOG=
+endif
 MODULES= disksup memsup cpu_sup os_mon os_mon_mib os_sup os_mon_sysinfo \
-	nteventlog
+	 $(NTEVENTLOG)
 
 INCLUDE=../include
 CSRC=../c_src
@@ -78,7 +83,11 @@ docs:
 # ----------------------------------------------------
 
 $(APP_TARGET): $(APP_SRC) ../vsn.mk
+ifeq ($(findstring win32,$(TARGET)),win32)
 	sed -e 's;%VSN%;$(VSN);' $< > $@
+else
+	sed -e 's;%VSN%;$(VSN);;s;,\s*nteventlog;;' $< > $@
+endif
 
 $(APPUP_TARGET): $(APPUP_SRC) ../vsn.mk
 	sed -e 's;%VSN%;$(VSN);' $< > $@
-- 
1.7.3.5

